# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка
```
export interface ICard {
  _id: string;
  description:string;
  image: string;
  title: string;
  category: string;
  price: number;
  
  isInBasket: boolean; //возможно метод
}
```
Корзина
```
export interface IBasketData {
  items: ICard[];
  total: number;
  preview: string | null; //для превью корзины
}
```

Данные карточки для корзины 
```
export type TCardMiniInfo = Pick<ICard, 'title'|'price'>
```

Данные о сумме из коризины
```
export type TTotalBasket = Pick<IBasket, 'total'>;
```

Интерфейс для массива карточек
```
export interface ICardsData {
  cards: ICard[];
  preview: string | null; //для превью выбранной карточки
}
```

Данные заказа
```
export interface IOrder {
  payment: string;
  address: string;
}
```

Данные контактов
```
export interface IContact {
  email: string;
  phone: string;
}
```
Общие данные с деталями заказа
```
type IOderData = IOrder & IContact & {
  total: number;
};
```

## Базовый код

### Класс EventEmitter - есть в изначальной версии проекта.

Реализует паттерн «EventEmitter» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.
Методы on ,  off ,  emit  — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.
Дополнительно реализованы методы  onAll и  offAll  — для подписки на все события и сброса всех подписчиков. 

Метод  trigger генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса  EventEmitter.

### Класс Api - есть в изначальной версии проекта.

Класс описывает логику работы с сервером. 
Констурктор:
```
constructor(baseUrl: string, options: RequestInit = {})
```
Принимает адрес сервера(url) и опциональный объект с заголовками запросов.

Методы:

- get - для GET запросов на сервер. Принимает часть адреса в качестве аргумента, возвращает промис с объектом, которым ответил сервер.
- post - принимает объекты с данными, которые необходимо отправить, часть адреса отправки и метод запроса (по умолчанию POST).

### Класс Сomponent

Базовый класс дженерик для отображения любого элемента.

Как аргумент принимает data: HTMLElement - темплейт или элемент разметки, являющийся родительским для разметки. Парaметр data необязательный, используем оператор ??, если значение undefined | null. Возвращаем элемент разметки.

```
  render(data?: Partial<T>): HTMLElement {
      Object.assign(this as object, data ?? {});
      return this.container;
  }
```

## Компоненты модели данных

### Class CardsData

Класс отвечает за работу с массивом карточек.\

В полях класса хранятся следующие данные:

- _cards: ICard[]; - массив карточек.
- _preview: string | null; - храним id выбранной карточки для превью в модальном окне.
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных.

Методы:
- getCard(cardId: string): ICard; - возвращает карточку по её id.
- сеттеры и геттеры для работы с полями класса:
set cards(cards: ICard[]) - принимает и заполняет массив карточек с сервера;
set preview(cardId: string | null) - принимает id карточки для хранения превью, если необходимо.

### Class BasketData

Класс для работы с карточками, отправленными в корзину.\

В полях класса хранятся следующие данные:
- items: ICard[]; - массив инфы карточек, отправленных в корзину
- total: number; - сумма всех товаров в корзине

Методы:
- addItem(item: ICard): void; - для добавления карточек в корзину
- deleteItem(item: ICard): void; - удаления карточек из карзины
- getBasketIds - получить id товаров в корзине (понадобится для объекта заказа)
- getTotal(items: ICard[]): number; - получить общую сумму товаров в корзине

### Class OrderData

Класс для сбора информации о заказе.\
Поля класса должны собирать необходимую о заказе информацию.
- payment: string; - тип оплаты
- address: string; - адрес заказа
- email: string; - почта оставившего заказ
- phone: string; - телефон оставившего заказ

Методы:
- сеттеры и геттеры значений;
- методы для валидации;

## Компоненты отображения

Отвечают за отображение внутри контейнера передаваемых в них данных.

### Class Card extends Component

Основной класс карточки. Делаем его универсальным, чтобы можно было отрисовать разную разметку в зависимости от переданного темплейта в аргумент конструктора. Так как класс расширяет родительский Component, метод render через Object.assign заполняет переданными аргументам необходимые сеттеры.

Поля:
- protected events: IEvents; - события;
- protected cardId: string; - id карточки;

элементы карточки:
- protected cardDescription?:HTMLElement;
- protected cardImage?: HTMLImageElement;
- protected cardTitle: HTMLElement;
- protected cardCategory?: HTMLElement;
- protected cardPrice: HTMLElement;
- protected buyButton?: HTMLElement;
- protected deleteButton?: HTMLElement;

Методы:

- Используем сеттеры для изменяемых значений, а также добавляем проверки, чтобы класс был универсальным и подходящим для трех разных темплейтов.

### Class Page extends Component

Класс для отрисовки каталога карточек на основной странице и счетчика товаров корзины. Имеет сеттер catalog, принимающий массив из элементов разметки карточек, созданных на основе массива с сервера. А также сеттер для количества товаров.

### Класс Modal
Универсальный класс реализациии модального окна.\

Поля:
- protected closeButton: HTMLButtonElement; - кнопка закрытия попапа
- protected _content: HTMLElement; - внутренний контент попапа

Констуктор:\
```
constructor(container: HTMLElement, protected events: IEvents);
```
принимает содержимое контента и экземпляр класса EventEmitter для инициации событий при изменении данных.

Методы:
- set content(value: HTMLElement); - меняем контент внутри попапа;
- open(); - открываем модалку;
- close(); - закрываем модалку;

### Class Basket

Класс для отображения корзины и ее содержимого.\

В полях класса хранятся следующие данные:
- _list: HTMLElement; - лист с товарами для отображения карточек
- _button: HTMLElement; - кнопка сабмита
- _total: HTMLElement; - общая сумма заказа
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных.

Методы:
- set items(items: HTMLElement[]) - заполняем корзину товарами
- render() - возвращает сгенерированную верстку корзины

### Class Form

Класс для работы с формами.  

Поля:
- protected formElement: HTMLFormElement; - форма
- protected _submit: HTMLButtonElement; - кнопка сабмита формы
- protected _errors: HTMLElement; - элемент для вывода ошибок
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных.

Методы:
- set errors() - установка ошибки валидации
- clearValue() - очистка формы
- render() - возвращение элемента формы

### Class Order extends Form

Класс с формой для заказа - выбора типа оплаты и установки адреса.\

Методы класса:
- set address(value: string) - для адреса
- switchButton(button: string, value: boolean) - для смены стилей кнопок


### Class Contact extends Form

Класс с формой для контактов - два инпута для ввода email и телефона.\

Методы класса:
- set email(value: string) - для email
- set phone(value: string) - для телефона


### Сlass Success

Класс для демонстрации успешного завершения заказа.\

Поля класса:
- _button: HTMLButtonElement - кнопка сабмита окошка, должна закрывать и очищать модалку

Метод:
- set total - метод, который позволит указывать общую сумму, потраченную на товары.


## Презентер

Код презентера не выделен в отдельный класс, а будет размещен в основном скрипте приложения - файле 'index.ts'.\

### Класс AppApi предоставляет методы для взаимодействия с бекэндом сервиса.

Используем один экземляр брокера событий.\
События:
- 'cards:changed' - изменения массива карточек;
- 'card:select' - выбор карточки по клику;

События при взаимодействии с пользователем:
- 'basket:open' - открытие модального окна с корзиной
- 'preview:changed' - передали выбранную карточку, сгенерировали ее превью
- 'item:addToBasket' - добавляем товар в корзину
- 'item:delete' - удаление товара из корзины
- 'basket:changed' - обновляем корзину
- 'contacts/order/название поле/:change' - изменение инпутов
- 'orderFormErrors:change' - событие для проверки полей заказа
- 'contactsFormErrors:change' - событие для проверки полей контактов
- 'order:open' - открытие модального окна с деталями заказа
- 'order:submit' - обрабатываем сабмит формы заказа, переходим к контактам
- 'contacts:submit' - обрататываем сабмит формы контактов, собираем объект заказа и делаем пост-запрос на сервер, при успешном ответе - открываем модалку с success
- 'success:submit' - закрытиe модального окна с успешным завершением заказа должна закрывать модальное окно
- 'modal:open'/'modal:close' - для работы с блоком страницы при модальном окне




